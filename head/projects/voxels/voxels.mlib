<?xml version="1.0" ?>
<materialLib name="Voxels">

	<renderTargets>
		<renderTarget name ="dummy">
			<SIZE width="GridSize" height="GridSize" />
			<colors>
				<color name="dummy" internalFormat="RGBA" />
			</colors>
		</renderTarget>
	</renderTargets>

	<textures>
		<texture name="gridColor">
			<WIDTH value="GridSize" />
			<HEIGHT value="GridSize" />
			<DEPTH value="GridSize" />
			<INTERNAL_FORMAT value="RGBA" />
		</texture>	
		<texture name="gridNormal">
			<WIDTH value="GridSize" />
			<HEIGHT value="GridSize" />
			<DEPTH value="GridSize" />
			<INTERNAL_FORMAT value="RGBA" />
		</texture>	
	</textures>

	<buffers>
		<buffer name="atomic">
			<SIZE value=32 />
		</buffer>
		<buffer name="position" >
			<SIZE value = 16 />
		</buffer>	
	</buffers>
	
	<shaders>
		<shader name="voxelization" 	vs = "shaders/voxelization.vert" 
										gs = "shaders/voxelization.geom"
										ps = "shaders/voxelization.frag" /> 
										
		<shader name="showVoxels" 		vs = "shaders/showVoxels.vert" 
										gs = "shaders/showVoxels.geom"
										ps = "shaders/showVoxels.frag" /> 
		<shader name="showVoxels2" 		vs = "shaders/showVoxels2.vert" 
										ps = "shaders/showVoxels2.frag" /> 
	</shaders>
	
	<states>
		<state name="voxelization">
				<CULL_FACE value=0 />
				<DEPTH_TEST value=0 />
		</state>	
	</states>
	
	<materials>
		<material name ="voxelization">
			<shader name="voxelization">
				<values>
					<valueof uniform="imageUnit"		type="CURRENT" context="IMAGE_TEXTURE"
															id=1 component="UNIT" />
					<valueof uniform="imageUnitN"		type="CURRENT" context="IMAGE_TEXTURE"
															id=2 component="UNIT" />
					<valueof uniform="camXPV"			type="CAMERA" context="xx"
															component="PROJECTION_VIEW_MATRIX" />
					<valueof uniform="camYPV"			type="CAMERA" context="yy"
															component="PROJECTION_VIEW_MATRIX" />
					<valueof uniform="camZPV"			type="CAMERA" context="zz"
															component="PROJECTION_VIEW_MATRIX" />
					<valueof uniform="WindowSize"		type="CURRENT" context="VIEWPORT"
															component="ABSOLUT_SIZE" />
					<valueof uniform="M"				type="CURRENT" context="RENDERER"
															component="MODEL" />
															
					<valueof uniform="diffuse" 		  	type="CURRENT" context="COLOR" 
														component="DIFFUSE" />
					<valueof uniform="shininess" 		type="CURRENT" context="COLOR" 
														component="SHININESS" />
					<valueof uniform="texCount"			type="CURRENT" context="RENDERER" 
														component="TEXTURE_COUNT" />
					<valueof uniform="texUnit" 			type="CURRENT" context="MATERIAL_TEXTURE" 
														component="UNIT" id="0" />				
				</values>
			</shader>
			
			<imageTextures>
				<imageTexture UNIT=1 texture="gridColor" >
					<ACCESS value="WRITE_ONLY" />
					<LEVEL value=0 />
					<CLEAR value=true/>
				</imageTexture>
				<imageTexture UNIT=2 texture="gridNormal" >
					<ACCESS value="WRITE_ONLY" />
					<LEVEL value=0 />
					<CLEAR value=true/>
				</imageTexture>
			</imageTextures>
			
			<buffers>	
				<buffer name="atomic"  >
					<TYPE value="ATOMIC_COUNTER" />
					<BINDING_POINT value="1" />
				</buffer>
			</buffers>	
			<state>
				<CULL_FACE value=0 />
				<DEPTH_TEST value=0 />
			</state>	
		</material>
	
		<material name ="showVoxels">
			<shader name="showVoxels">
				<values>
					<valueof uniform="RayOrigin"        type="CURRENT" context="CAMERA" 
															component="POSITION" />
					<valueof uniform="FOV"				type="CURRENT" context="CAMERA"
															component="FOV" />
					<valueof uniform="PVM"          	type="CURRENT" context="RENDERER" 
															component="PROJECTION_VIEW_MODEL" />
					<valueof uniform="VM"         		type="CURRENT" context="RENDERER" 
															component="VIEW_MODEL" />
					<valueof uniform="grid"				type="CURRENT" context="MATERIAL_TEXTURE"
															id=1 component="UNIT" />
					<valueof uniform="WindowSize"		type="CURRENT" context="VIEWPORT"
															component="ABSOLUT_SIZE" />
					<valueof uniform="GridSize" 		type="CURRENT" context="PASS"
															component="GridSize" />
				</values>
			</shader>
			
			<textures>
				<texture UNIT=1 name="gridColor" >
					<MIN_FILTER value="NEAREST" />
					<MAG_FILTER value="NEAREST" />
					<WRAP_S value="CLAMP_TO_BORDER" />
					<WRAP_T value="CLAMP_TO_BORDER" />
					<WRAP_R value="CLAMP_TO_BORDER" />
				</texture>
			</textures>
			<state>
				<CULL_FACE value=0 />
			</state>	
			
		</material>

		<material name ="showVoxels2">
			<shader name="showVoxels2">
				<values>
					<valueof uniform="PVM"          	type="CURRENT" context="RENDERER" 
															component="PROJECTION_VIEW_MODEL" />
					<valueof uniform="GridSize" 		type="CURRENT" context="PASS"
															component="GridSize" />
					<valueof uniform="grid"				type="CURRENT" context="MATERIAL_TEXTURE"
															id=1 component="UNIT" />
					<valueof uniform="gridN"				type="CURRENT" context="MATERIAL_TEXTURE"
															id=2 component="UNIT" />
				</values>
			</shader>
			
			<textures>
				<texture UNIT=1 name="gridColor" >
					<MIN_FILTER value="NEAREST" />
					<MAG_FILTER value="NEAREST" />
					<WRAP_S value="CLAMP_TO_BORDER" />
					<WRAP_T value="CLAMP_TO_BORDER" />
					<WRAP_R value="CLAMP_TO_BORDER" />
				</texture>
				<texture UNIT=2 name="gridNormal" >
					<MIN_FILTER value="NEAREST" />
					<MAG_FILTER value="NEAREST" />
					<WRAP_S value="CLAMP_TO_BORDER" />
					<WRAP_T value="CLAMP_TO_BORDER" />
					<WRAP_R value="CLAMP_TO_BORDER" />
				</texture>
			</textures>		
		</material>

		</materials>
	
</materialLib>